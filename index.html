<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>FoolsTool - Proxy Ver</title>
</head>
<body style="background-color: #000; color: #0f0; font-family: monospace; padding: 20px;">

    <h2>通信テスト: Strong Proxy</h2>
    <div id="status">接続試行中...</div>
    <div id="video-list"></div>

    <script>
        // ---------------------------------------------------
        // 設定: 強力なプロキシを使う
        // ---------------------------------------------------
        
        // ターゲット: 比較的安定しているサーバー
        const TARGET = "https://invidious.drgns.space/api/v1/popular";
        
        // プロキシ: corsproxy.io (alloriginsより制限が緩いことが多い)
        const PROXY = "https://corsproxy.io/?";

        // ---------------------------------------------------

        async function tryConnect() {
            const status = document.getElementById("status");
            const list = document.getElementById("video-list");

            // 最終的なURL: プロキシの後ろにターゲットURLをくっつける
            // encodeURIComponentを使ってURLを「文字」として正しく渡す
            const finalUrl = PROXY + encodeURIComponent(TARGET);

            status.innerHTML += `<br>アクセス先: ${finalUrl}<br>`;

            try {
                const response = await fetch(finalUrl);

                if (!response.ok) {
                    throw new Error(`サーバーエラー: ${response.status}`);
                }

                const data = await response.json();
                
                status.innerHTML = `<h2 style="color:cyan">成功しました！</h2>`;
                
                // データ表示
                data.slice(0, 5).forEach(video => {
                    list.innerHTML += `
                        <div style="border:1px solid #333; margin:10px; padding:10px;">
                            <img src="${PROXY + encodeURIComponent(video.videoThumbnails[0].url)}" width="150"><br>
                            <b>${video.title}</b>
                        </div>
                    `;
                });

            } catch (err) {
                console.error(err);
                status.innerHTML += `<br><strong style="color:red">失敗: ${err.message}</strong>`;
                status.innerHTML += `<br>ヒント: BraveのシールドをOFFにしてください`;
            }
        }

        tryConnect();
    </script>
</body>
</html>
