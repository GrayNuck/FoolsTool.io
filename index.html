<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>FoolsTool - Chrome Ver</title>
</head>
<body style="background-color: #121212; color: white; font-family: sans-serif; padding: 20px;">

    <h1>FoolsTool (Direct Connect)</h1>
    <div id="status">サーバーに接続中...</div>
    <div id="video-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;"></div>

    <script>
        // ---------------------------------------------------
        // 【決定版】Chromeならこれで動く！
        // ---------------------------------------------------
        
        // プロキシは使いません（不安定なため）
        // その代わり、外部接続を許可している「tux.pizza」を使います
        const TARGET_SERVER = "https://inv.tux.pizza"; 

        // 予備のサーバー（もし上がダメならこっちに書き換えてください）
        // const TARGET_SERVER = "https://yewtu.be";
        // const TARGET_SERVER = "https://vid.puffyan.us";

        // ---------------------------------------------------

        async function loadPopularVideos() {
            const status = document.getElementById("status");
            const list = document.getElementById("video-list");

            try {
                // APIのURLを作る
                const url = TARGET_SERVER + "/api/v1/popular";
                console.log("ここにアクセスします:", url);

                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`サーバーエラー: ${response.status}`);
                }

                const videos = await response.json();

                // 成功表示
                status.innerHTML = `<h3 style="color: #4CAF50;">接続成功！ (${TARGET_SERVER})</h3>`;
                
                // 動画を並べる
                videos.forEach(video => {
                    list.innerHTML += `
                        <div style="background: #222; border-radius: 10px; overflow: hidden;">
                            <img src="${video.videoThumbnails[0].url}" style="width: 100%; aspect-ratio: 16/9; object-fit: cover;">
                            <div style="padding: 10px;">
                                <h4 style="margin: 0 0 10px 0; font-size: 16px;">${video.title}</h4>
                                <p style="color: #aaa; font-size: 12px;">再生回数: ${video.viewCountText || "不明"}</p>
                            </div>
                        </div>
                    `;
                });

            } catch (error) {
                console.error(error);
                status.innerHTML = `
                    <h3 style="color: #ff5555;">接続失敗...</h3>
                    <p>エラー内容: ${error.message}</p>
                    <p>もしかすると、数分待つか、サーバーURLを予備のものに変えてみてください。</p>
                `;
            }
        }

        loadPopularVideos();
    </script>
</body>
</html>
