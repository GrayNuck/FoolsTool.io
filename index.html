<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>FoolsTool - Home Dev</title>
</head>
<body style="background-color: #1a1a1a; color: white; font-family: sans-serif;">

    <h1>FoolsTool (Home Ver)</h1>
    <div id="video-list">読み込み中...</div>

    <script>
        // ---------------------------------------------------
        // 【修正版】家で開発するための設定
        // ---------------------------------------------------
        
        // ★重要：このサーバーはCORS設定が緩いので、プロキシなしで繋がります
        // もしダメなら "https://invidious.drgns.space" を試してください
        const TARGET_SERVER = "https://inv.tux.pizza"; 
        
        // ★重要：家ではプロキシを使いません（空にする）
        // プロキシを通すと逆にブロックされることがあるためです
        const PROXY_URL = ""; 

        // ---------------------------------------------------

        async function loadPopularVideos() {
            const list = document.getElementById("video-list");

            try {
                // そのままのURLでアクセス
                const finalUrl = TARGET_SERVER + "/api/v1/popular";
                console.log("アクセス中:", finalUrl);

                const response = await fetch(finalUrl);
                
                // エラーチェック（HTMLが返ってきていないか確認）
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") === -1) {
                    // JSONじゃないものが返ってきたらテキストとして表示（デバッグ用）
                    const text = await response.text();
                    throw new Error("JSONではなくHTMLが返ってきました。中身: " + text.substring(0, 100));
                }

                if (!response.ok) {
                    throw new Error("サーバーエラー: " + response.status);
                }

                const videos = await response.json();

                // 成功したら表示
                list.innerHTML = ""; 
                videos.forEach(video => {
                    list.innerHTML += `
                        <div style="margin-bottom: 20px; border: 1px solid #333; padding: 10px;">
                            <h3>${video.title}</h3>
                            <img src="${video.videoThumbnails[0].url}" width="300">
                        </div>
                    `;
                });

            } catch (error) {
                console.error(error);
                list.innerHTML = `
                    <h3 style="color: red;">エラー発生</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        loadPopularVideos();
    </script>
</body>
</html>
