<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoolsTool - My YouTube</title>
</head>
<body style="background-color: #1a1a1a; color: white; font-family: sans-serif;">

    <h1>FoolsTool</h1>
    <div id="video-list">読み込み中...</div>

    <script>
        // ---------------------------------------------------
        // 【重要】ここが魔法の修正ポイント
        // ---------------------------------------------------
        
        // データをくれるInvidiousサーバー
        const TARGET_SERVER = "https://invidious.f5.si"; 
        
        // ★ これを追加！「CORS回避用プロキシ」
        // これを通すと、学校のSafariでも他人のサーバーのデータが取れるようになります
        const PROXY_URL = "https://api.allorigins.win/raw?url=";

        // ---------------------------------------------------

        async function loadPopularVideos() {
            const list = document.getElementById("video-list");

            try {
                // URLを「プロキシ + 欲しいURL」の形に合体させる
                const finalUrl = PROXY_URL + encodeURIComponent(TARGET_SERVER + "/api/v1/popular");
                
                console.log("アクセス中:", finalUrl);

                const response = await fetch(finalUrl);
                
                if (!response.ok) {
                    throw new Error("サーバーエラー: " + response.status);
                }

                const videos = await response.json();

                // 画面をクリア
                list.innerHTML = ""; 

                videos.forEach(video => {
                    list.innerHTML += `
                        <div style="margin-bottom: 20px; border: 1px solid #333; padding: 10px; border-radius: 8px;">
                            <h3>${video.title}</h3>
                            <p style="color: #aaa;">再生回数: ${video.viewCountText || "不明"}</p>
                            <img src="${video.videoThumbnails[0].url}" width="300" style="max-width:100%; border-radius: 4px;">
                        </div>
                    `;
                });

            } catch (error) {
                console.error(error);
                // エラーが出たときの表示
                list.innerHTML = `
                    <h3 style="color: #ff5555;">エラーが発生しました</h3>
                    <p>考えられる原因:</p>
                    <ul>
                        <li>学校のWi-Fiが「api.allorigins.win」をブロックしている</li>
                        <li>サーバー(${TARGET_SERVER})がダウンしている</li>
                    </ul>
                    <p>詳細: ${error}</p>
                `;
            }
        }

        loadPopularVideos();
    </script>
</body>
</html>
